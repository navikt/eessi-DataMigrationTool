<?xml version="1.0"?>
<case name="R_BUC_01" version="4.1" role="PO" xmlns="http://ec.europa.eu/eessi/rina/buc">

    <!-- CONFIG FILE R1.conf
    PROC=[R_BUC_01]
    VER=[4.2]
    PATCH=[20190702]
    ISML=[false]
    STARTERS=[R001]
    POCREATED=[R003]
    CPCREATED=[R002 R004]
    HSUBS=[H1 H7]
    XADMINS=[X001 X007 X009]
    -->

    <!-- BONITA EXTRACT
    PO_R_BUC_01_v4.2-v20190702.proc
    000033 [Create R001] exists
    000044 [Create R001] method = createEmptyMetadata
    000067 [Create R001] docId = tmpDocId
    000072 [Create R001] selectParticipants = isFirstR001
    000077 [Create R001] hasReject = false
    000082 [Create R001] hasCancel = true
    000087 [Create R001] hasMultipleVersions = true
    000092 [Create R001] isMLC = false
    000112 [Read R002] exists
    000180 [Read R002] docId = tmpDocId
    000185 [Read R002] selectParticipants = false
    000190 [Read R002] hasReject = false
    000195 [Read R002] hasCancel = true
    000437 [Create R003] exists
    000448 [Create R003] method = createEmptyMetadata
    000470 [Create R003] docId = tmpDocId
    000475 [Create R003] selectParticipants = false
    000480 [Create R003] hasReject = false
    000485 [Create R003] isMLC = false
    000490 [Create R003] hasCancel = true
    000495 [Create R003] hasMultipleVersions = true
    000615 [Read R004] exists
    000653 [Read R004] docId = tmpDocId
    000658 [Read R004] selectParticipants = false
    000663 [Read R004] hasReject = false
    000668 [Read R004] hasCancel = true
    000703 [Initialise Forwarded Process] exists
    000727 [Initialise Forwarded Process] lastMessageId = lastMessageId
    000732 [Initialise Forwarded Process] receivedWhoAmI = receivedWhoAmI
    000737 [Initialise Forwarded Process] flowid = flowid
    000748 [Forward R001] exists
    000761 [Forward R001] docId = lastDocumentId
    000766 [Forward R001] selectParticipants = true
    000771 [Forward R001] hasCancel = true
    000776 [Forward R001] receivedAction = docType
    000781 [Forward R001] hasReject = false
    000786 [Forward R001] isMLC = false
    000791 [Forward R001] hasMultipleVersions = true
    000799 [Common] exists
    000809 [Common] isPO = true
    000814 [Common] hasLocalClose = false
    000852 [H_BUC_01] exists
    000862 [H_BUC_01] flowid = flowid
    000867 [H_BUC_01] whoami = whoami
    000893 [SUBPROCESS H_BUC_07] exists
    000903 [SUBPROCESS H_BUC_07] flowid = flowid
    000908 [SUBPROCESS H_BUC_07] whoami = whoami
    000913 [SUBPROCESS H_BUC_07] isMainProcess = false
    000918 [SUBPROCESS H_BUC_07] mayCreateH070 = true
    000923 [SUBPROCESS H_BUC_07] hasPORole = true
    000928 [SUBPROCESS H_BUC_07] hasCPRole = true
    000933 [SUBPROCESS H_BUC_07] mayChooseParticipants = true
    000938 [SUBPROCESS H_BUC_07] mayLoopH070 = false
    001015 [Call Read Close] exists
    001049 [Call Read Close] docId = tmpX001Id
    001054 [Call Read Close] isPO = false
    001059 [Call Read Close] hasReopen = true
    001067 [Call Close] exists
    001080 [Call Close] docId = tmpX001Id
    001085 [Call Close] isPO = true
    001090 [Call Close] hasReopen = true
    001333 [Call AddRemoveForward] exists
    001343 [Call AddRemoveForward] whoami = whoami
    001348 [Call AddRemoveForward] flowid = flowid
    001353 [Call AddRemoveForward] isPO = true
    001358 [Call AddRemoveForward] hasAddParticipant = false
    001363 [Call AddRemoveForward] hasRemoveParticipant = false
    -->

    <!-- BONITA EXTRACT
    CP_R_BUC_01_v4.2-v20190702.proc
    000061 [Create R002] exists
    000072 [Create R002] method = createAnswerMetadata
    000095 [Create R002] selectParticipants = false
    000100 [Create R002] docId = tmpDocId
    000105 [Create R002] hasReject = false
    000240 [Read R003] exists
    000319 [Read R003] docId = tmpDocId
    000324 [Read R003] selectParticipants = false
    000329 [Read R003] hasReject = false
    000334 [Read R003] hasCancel = true
    000342 [Read R001] exists
    000408 [Read R001] docId = tmpDocId
    000413 [Read R001] selectParticipants = true
    000418 [Read R001] hasReject = false
    000519 [Create R004] exists
    000530 [Create R004] method = createEmptyMetadata
    000552 [Create R004] selectParticipants = false
    000557 [Create R004] docId = tmpDocId
    000562 [Create R004] hasReject = false
    000576 [Read Update R001] exists
    000634 [Read Update R001] selectParticipants = true
    000639 [Read Update R001] hasCancel = true
    000644 [Read Update R001] hasReject = false
    000649 [Read Update R001] docId = tmpDocId
    000680 [Common] exists
    000690 [Common] hasLocalClose = false
    000698 [H_BUC_01] exists
    000708 [H_BUC_01] flowid = flowid
    000713 [H_BUC_01] whoami = receivedWhoAmI
    000795 [SUBPROCESS H_BUC_07] exists
    000805 [SUBPROCESS H_BUC_07] flowid = flowid
    000810 [SUBPROCESS H_BUC_07] whoami = whoami
    000815 [SUBPROCESS H_BUC_07] isMainProcess = false
    000820 [SUBPROCESS H_BUC_07] mayCreateH070 = true
    000825 [SUBPROCESS H_BUC_07] hasPORole = true
    000830 [SUBPROCESS H_BUC_07] hasCPRole = true
    000835 [SUBPROCESS H_BUC_07] mayChooseParticipants = true
    000840 [SUBPROCESS H_BUC_07] mayLoopH070 = false
    000880 [Create R002 (Replace)] exists
    000891 [Create R002 (Replace)] method = createAnswerMetadata
    000914 [Create R002 (Replace)] selectParticipants = false
    000919 [Create R002 (Replace)] docId = tmpDocId
    000924 [Create R002 (Replace)] hasReject = false
    000929 [Create R002 (Replace)] hasClarify = false
    001196 [Call Read Close] exists
    001230 [Call Read Close] docId = tmpX001Id
    001235 [Call Read Close] isPO = false
    001240 [Call Read Close] hasReopen = true
    001322 [Call Close] exists
    001335 [Call Close] docId = tmpX001Id
    001340 [Call Close] isPO = true
    001345 [Call Close] hasReopen = true
    001367 [Call AddRemoveForward] exists
    001377 [Call AddRemoveForward] whoami = whoami
    001382 [Call AddRemoveForward] flowid = flowid
    001387 [Call AddRemoveForward] isPO = false
    001392 [Call AddRemoveForward] hasAddParticipant = false
    001397 [Call AddRemoveForward] hasRemoveParticipant = false
    -->

    <!-- CONFIG FILE R1.conf
    PROC=[R_BUC_01]
    VER=[4.2]
    PATCH=[20190702]
    ISML=[false]
    STARTERS=[R001]
    POCREATED=[R003]
    CPCREATED=[R002 R004]
    HSUBS=[H1 H7]
    XADMINS=[X001 X007 X009]
    -->

    <!-- DEDUCED FROM PO BONITA EXTRACT
    removeOnlyMe=[false]
    hasClose=[true]
    hasReopen=[true]
    hasLocalClose=[false]
    canSendReminder=[true]
    canReplyReminder=[true]
    hasAddParticipant=[false]
    hasRemoveParticipant=[false]
    hasForwardParticipant=[true]
    canCreateH001=[true]
    mayCreateH020=[false]
    mayCreateH120=[false]
    mayCreateH121=[false]
    mayLoopH070=[false]
    -->

    <!-- DEDUCED FROM CP BONITA EXTRACT
    removeOnlyMe=[false]
    hasClose=[true]
    hasReopen=[true]
    hasLocalClose=[false]
    canSendReminder=[true]
    canReplyReminder=[true]
    hasAddParticipant=[false]
    hasRemoveParticipant=[false]
    hasForwardParticipant=[true]
    canCreateH001=[true]
    mayCreateH020=[false]
    mayCreateH120=[false]
    mayCreateH121=[false]
    mayLoopH070=[false]
    -->

    <context>
        <parameters>
            <!-- isML (default is true; the current BUC is isML=false) -->
            <parameter key="isML">false</parameter> <!-- default is true -->
            <!-- removeMeOnly is not considered in PO -->
        </parameters>
    </context>

    <actions>
        <!-- empty -->
    </actions>

    <documents>
        <document type="R001">
            <parameters>
                <parameter key="isStarter">true</parameter> <!-- default is false -->
                <parameter key="hasMultipleVersions">true</parameter> <!-- default is false -->
                <parameter key="hasCancel">true</parameter> <!-- default is false -->
                <parameter key="hasClarify">true</parameter> <!-- default is false -->
                <parameter key="recreateAfterCancel">true</parameter> <!-- default is false -->
                <parameter key="allowsAttachments">true</parameter> <!-- default is false -->
            </parameters>
            <triggers>

                <!-- ADMINISTRATIVE SUBPROCESSES -->

                <!-- for starter only, global close -->
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_CREATE"
                                     documentType="X001"/>
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_RECEIVE"
                                     documentType="X001"/>

                <!-- for starter only, forward -->
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_CREATE"
                                     documentType="X007"/>
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_RECEIVE"
                                     documentType="X007"/>

                <!-- for starter only, reminder -->
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_CREATE"
                                     documentType="X009"/>
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_RECEIVE"
                                     documentType="X009"/>

                <!-- for starter only, business exception -->
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_RECEIVE"
                                     documentType="X050"/>

                <!-- for starter only, change participants -->
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_RECEIVE"
                                     documentType="X100"/>


                <!-- HORIZONTAL SUBPROCESSES -->

                <!-- for starter only, subprocess H_BUC_01 -->
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_CREATE"
                                     documentType="H001"/>
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_RECEIVE"
                                     documentType="H001"/>

                <!-- for starter only, subprocess H_BUC_07 -->
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_CREATE"
                                     documentType="H070"/>
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_RECEIVE"
                                     documentType="H070"/>

                <!-- MAIN FLOW -->

                <!-- for starter only, receivers -->
                <createActionTrigger onAction="DOC_SEND" onResult="SUCCESS" actionType="DOC_RECEIVE_REPLY"
                                     documentType="R002"/>
                <createActionTrigger onAction="DOC_SEND" onlyStarter="true" onResult="SUCCESS" actionType="DOC_RECEIVE"
                                     documentType="R004"/>


            </triggers>
        </document>

        <document type="R002">
            <parameters>
                <parameter key="hasClarify">true</parameter> <!-- default is false -->
                <parameter key="hasMultipleVersions">true</parameter> <!-- default is false -->
                <parameter key="hasCancel">true</parameter> <!-- default is false -->
            </parameters>
            <triggers>

                <!-- onCondition (No valid R003 yet, R002 with deductions, R001 provisional) -->

                <createActionTrigger onAction="DOC_RECEIVE" onResult="SUCCESS" onCondition="po_r_buc_01_PROV"
                                     actionType="DOC_CREATE" documentType="R001"/>
                <createActionTrigger onAction="DOC_UPDATE_RECEIVE" onResult="SUCCESS" onCondition="po_r_buc_01_PROV"
                                     actionType="DOC_CREATE" documentType="R001"/>

                <!-- onCondition (No valid R003 yet, R002 with deductions, R001 final) -->

                <createActionTrigger onAction="DOC_RECEIVE" onResult="SUCCESS" onCondition="po_r_buc_01_FINAL"
                                     actionType="DOC_CREATE" documentType="R003"/>
                <createActionTrigger onAction="DOC_UPDATE_RECEIVE" onResult="SUCCESS" onCondition="po_r_buc_01_FINAL"
                                     actionType="DOC_CREATE" documentType="R003"/>
									 
            </triggers>
        </document>

        <document type="R003">
            <parameters>
                <parameter key="hasMultipleVersions">true</parameter> <!-- default is false -->
                <parameter key="hasCancel">true</parameter> <!-- default is false -->
                <parameter key="hasClarify">true</parameter> <!-- default is false -->
                <parameter key="allowsAttachments">true</parameter> <!-- default is false -->
            </parameters>
            <triggers>
                <!-- onCondition (if there exists a R002 not cancelled) -->
                <createActionTrigger onAction="DOC_CANCEL" onResult="SUCCESS" onCondition="po_r_buc_01_VALID" actionType="DOC_CREATE" documentType="R003"/>
            </triggers>
        </document>

        <document type="R004">
            <parameters>
                <parameter key="hasClarify">true</parameter> <!-- default is false -->
                <parameter key="hasMultipleVersions">true</parameter> <!-- default is false -->
                <parameter key="hasCancel">true</parameter> <!-- default is false -->
            </parameters>
        </document>


        <!-- subprocess H_BUC_01 -->

        <document type="H001">
            <parameters>
                <parameter key="hasMultipleVersions">true</parameter>
                <parameter key="hasCancel">true</parameter>
                <parameter key="recreateAfterSend">true</parameter>
                <parameter key="allowsAttachments">true</parameter>
            </parameters>
            <triggers>
                <createActionTrigger onAction="DOC_RECEIVE" onResult="SUCCESS" actionType="DOC_CREATE_REPLY"
                                     documentType="H002"/>
                <createActionTrigger onAction="DOC_SEND" onResult="SUCCESS" actionType="DOC_RECEIVE_REPLY"
                                     documentType="H002"/>
            </triggers>
        </document>

        <document type="H002">
            <parameters>
                <parameter key="hasMultipleVersions">true</parameter>
                <parameter key="hasCancel">true</parameter>
                <parameter key="recreateAfterCancel">true</parameter>
                <parameter key="allowsAttachments">true</parameter>
            </parameters>
        </document>

        <!-- subprocess H_BUC_07 -->

        <document type="H070">
            <parameters>
                <parameter key="hasMultipleVersions">true</parameter>
                <parameter key="hasCancel">true</parameter>
                <!-- in current BUC, mayLoopH070=false (default true) -->
                <!-- recreate after cancel is requested (mayLoopH070=false) -->
                <parameter key="recreateAfterCancel">true</parameter>
                <parameter key="allowsAttachments">true</parameter>
            </parameters>
        </document>

        <!-- Close -->
        <document type="X001">
            <!-- hasBusinessValidation if X001 may be sent (in current BUC, PO has hasClose=true) -->
            <parameters>
                <parameter key="hasBusinessValidation">true</parameter>
            </parameters>
            <!-- triggers added if X002 may be sent or received (in current BUC, PO has hasReopen=true and other side CP has hasReopen=true) -->
            <triggers>
                <!-- Create receive tasks if X002 may be received (in current BUC, some other participant has hasReopen=true) -->
                <!-- (in current BUC, some other participant has hasClose=true) -->
                <createActionTrigger onAction="DOC_RECEIVE" onResult="SUCCESS" actionType="DOC_RECEIVE_REPLY"
                                     documentType="X002"/>
                <!-- (in current BUC, PO has hasClose=true) -->
                <createActionTrigger onAction="DOC_SEND" onResult="SUCCESS" actionType="DOC_RECEIVE_REPLY"
                                     documentType="X002"/>
                <!-- Create Reply/Child tasks if X002 may be sent (in current BUC, PO has hasReopen=true) -->
                <!-- (in current BUC, some other participant has hasClose=true) -->
                <createActionTrigger onAction="DOC_RECEIVE" onResult="SUCCESS" actionType="DOC_CREATE_REPLY"
                                     documentType="X002"/>
                <!-- (in current BUC, PO has hasClose=true) -->
                <createActionTrigger onAction="DOC_SEND" onResult="SUCCESS" actionType="DOC_CREATE_REPLY"
                                     documentType="X002"/>
            </triggers>
        </document>

        <!-- document X002 added if X002 may be sent or received (in current BUC, PO has hasReopen=true and other side CP has hasReopen=true) -->
        <document type="X002">
            <!-- The BUC engine will take care of X003 and X004 automatically -->
            <!-- hasBusinessValidation if X002 may be sent (in current BUC, PO has hasReopen=true) -->
            <parameters>
                <parameter key="hasBusinessValidation">true</parameter>
            </parameters>
        </document>

        <!-- Forward Case -->
        <document type="X007">
            <!-- hasBusinessValidation and CASE_ARCHIVE used if X007 may be sent (in current BUC, PO has hasForwardParticipant=true) -->
            <parameters>
                <parameter key="hasBusinessValidation">true</parameter>
            </parameters>
            <triggers>
                <createActionTrigger onAction="DOC_SEND" onResult="SUCCESS" actionType="CASE_ARCHIVE"/>
            </triggers>
        </document>

        <!-- Reminder -->
        <document type="X009">
            <!-- If X009 may be sent (in current BUC, PO has canSendReminder=true) -->
            <parameters>
                <parameter key="recreateAfterSend">true</parameter>
            </parameters>
            <triggers>
                <!-- Create reply task if X010 may be sent (in current BUC, PO has canReplyReminder=true) -->
                <createActionTrigger onAction="DOC_RECEIVE" onResult="SUCCESS" actionType="DOC_CREATE_REPLY"
                                     documentType="X010"/>
                <!-- Create receive task if X010 may be received (in current BUC, other side CP has canReplyReminder=true) -->
                <createActionTrigger onAction="DOC_SEND" onResult="SUCCESS" actionType="DOC_RECEIVE_REPLY"
                                     documentType="X010"/>
            </triggers>
        </document>

        <document type="X010">
            <!-- in current BUC, PO has canReplyReminder=true -->
        </document>

    </documents>
</case>